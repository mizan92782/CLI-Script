#!/bin/bash

# ====== Virtual Environment Manager for Django ======
# Usage: ./venv_manager.sh [command]
# Commands:
#   create      - Create a new virtual environment
#   activate    - Activate the virtual environment
#   deactivate  - Deactivate the virtual environment
#   remove      - Remove the virtual environment
#   info        - Show venv configuration
#   install     - Install Django and common packages
#   list        - List installed packages
#   help        - Show this help message

VENV_DIR="venv"

case "$1" in
    create)
        echo "Creating virtual environment in $VENV_DIR..."
        python3 -m venv "$VENV_DIR"
        echo "Done. Activate with: source $VENV_DIR/bin/activate"
        ;;
    
    activate)
        if [ -d "$VENV_DIR" ]; then
            echo "Activating virtual environment..."
            source "$VENV_DIR/bin/activate"
        else
            echo "Virtual environment not found. Create it first using 'create'."
        fi
        ;;
    
    deactivate)
        echo "Deactivating virtual environment..."
        deactivate 2>/dev/null || echo "No virtual environment active."
        ;;
    
    remove)
        echo "Removing virtual environment..."
        rm -rf "$VENV_DIR"
        echo "Removed $VENV_DIR."
        ;;
    
    info)
        if [ -f "$VENV_DIR/pyvenv.cfg" ]; then
            echo "Showing virtual environment configuration:"
            cat "$VENV_DIR/pyvenv.cfg"
        else
            echo "Virtual environment not found."
        fi
        ;;
    
    install)
        echo ""
        echo "Select package groups to install (type numbers separated by space):"
        echo "1) Core Django"
        echo "2) Development Tools"
        echo "3) REST API Tools"
        echo "4) Authentication & Security"
        echo "5) Storage & File Handling"
        echo "6) Production / Deployment"
        echo "7) Database Helpers & Filters"
        echo "8) Database Tools (CLI/GUI)"
        echo "9) API Viewer Tools (HTTPie + Swagger)"

        read -p "Enter choices: " choices

        for choice in $choices; do
            case $choice in
                1)
                    echo "üîπ Installing Core Django packages..."
                    pip install django
                    ;;
                2)
                    echo "üîπ Installing Development Tools..."
                    pip install django-extensions django-debug-toolbar
                    ;;
                3)
                    echo "üîπ Installing REST API Tools..."
                    pip install djangorestframework drf-yasg drf-spectacular djangorestframework-simplejwt
                    ;;
                4)
                    echo "üîπ Installing Authentication & Security packages..."
                    pip install django-allauth django-cors-headers
                    ;;
                5)
                    echo "üîπ Installing Storage & File Handling packages..."
                    pip install django-storages
                    ;;
                6)
                    echo "üîπ Installing Production / Deployment packages..."
                    pip install gunicorn whitenoise
                    ;;
                7)
                    echo "üîπ Installing Database Helpers & Filters..."
                    pip install django-filter django-import-export
                    ;;
                8)
                    echo "üîπ Installing Database Tools..."
                    sudo apt install -y pgcli mycli
                    echo "üí° For GUI: DBeaver can be installed manually from https://dbeaver.io/download/"
                    ;;
                9)
                    echo "üîπ Installing API Viewer Tools..."
                    pip install httpie swagger-ui-bundle
                    echo "üí° For GUI API testing: Postman or Insomnia can be installed manually"
                    echo "üí° Swagger UI bundle is installed for local hosting if needed"
                    ;;
                *)
                    echo "‚ùå Invalid choice: $choice"
                    ;;
            esac
        done

        echo "‚úÖ Selected packages installed successfully!"
        ;;
    
    list)
        if [ -d "$VENV_DIR" ]; then
            source "$VENV_DIR/bin/activate"
            pip list
        else
            echo "Virtual environment not found."
        fi
        ;;
    
    help|*)
        echo "Usage: $0 [command]"
        echo "Commands:"
        echo "  create      - Create a new virtual environment"
        echo "  activate    - Activate the virtual environment"
        echo "  deactivate  - Deactivate the virtual environment"
        echo "  remove      - Remove the virtual environment"
        echo "  info        - Show venv configuration"
        echo "  install     - Install Django and common packages"
        echo "  list        - List installed packages"
        echo "  help        - Show this help message"
        ;;
esac
